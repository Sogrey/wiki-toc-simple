/**
 * Wiki.js 多级目录生成器 - 简化版
 * 
 * 功能描述：
 * - 解决Wiki.js原生目录只能显示两级的问题
 * - 自动扫描页面内容中的所有标题（h1-h6）
 * - 生成带锚点链接的多级目录树
 * - 支持平滑滚动到对应标题位置
 * - 适配深色主题，提供美观的视觉效果
 * 
 * 主要特性：
 * - 自动检测标题层级并生成缩进
 * - 优先使用Wiki.js已有的锚点ID
 * - 响应式设计，支持移动端
 * - 自定义滚动条样式
 * - 提供API接口供外部调用
 * 
 * 作者：Sogrey
 * 版本：1.0.0
 * 兼容性：现代浏览器（Chrome、Firefox、Safari、Edge）
 */
(function(){'use strict';const config={contentSelector:'.contents, [class*="contents"], main .contents',tocSelector:'.v-list--nav, [class*="v-list--nav"], .page-col-sd .v-list',tocTitle:'目录',scrollOffset:80};function removeExistingTOC(){const existingTOC=document.querySelector('.wiki-toc-simple');if(existingTOC){existingTOC.remove();console.log('已移除旧目录')}const originalTOC=document.querySelector(config.tocSelector);if(originalTOC){originalTOC.style.display=''}}function generateTOC(){removeExistingTOC();const content=document.querySelector(config.contentSelector);if(!content){console.warn('未找到文章内容，请检查 contentSelector 配置');return}const headings=content.querySelectorAll('h1, h2, h3, h4, h5, h6');if(headings.length===0){console.log('未找到标题元素，无法生成目录');return}let tocHTML=`<div class="wiki-toc-simple"><div class="wiki-toc-title">${config.tocTitle}</div><ul class="wiki-toc-list">`;headings.forEach((heading,index)=>{const level=parseInt(heading.tagName.charAt(1));const text=heading.textContent.trim();let id='';if(heading.id){id=heading.id}else{const anchorLink=heading.querySelector('a[href^="#"]');if(anchorLink){id=anchorLink.getAttribute('href').substring(1)}}if(!id){id=generateId(text,index);if(!heading.id){heading.id=id}}const indent=(level-1)*12+5;tocHTML+=`<li class="wiki-toc-item"data-level="${level}"><a href="#${id}"class="wiki-toc-link"style="padding-left: ${indent}px;">${text}</a></li>`});tocHTML+='</ul></div>';insertTOC(tocHTML);bindEvents();console.log(`目录生成完成，共${headings.length}个标题`)}function generateId(text,index){let id=text.toLowerCase().replace(/[^\w\u4e00-\u9fa5]/g,'-').replace(/-+/g,'-').replace(/^-|-$/g,'');if(!id){id=`heading-${index}`}return id}function insertTOC(tocHTML){const tocContainer=document.querySelector(config.tocSelector);if(tocContainer){const newToc=document.createElement('div');newToc.innerHTML=tocHTML;tocContainer.parentNode.insertBefore(newToc.firstElementChild,tocContainer);tocContainer.style.display='none'}}function bindEvents(){const links=document.querySelectorAll('.wiki-toc-link');links.forEach(link=>{link.addEventListener('click',function(e){e.preventDefault();const targetId=this.getAttribute('href').substring(1);const target=document.getElementById(targetId);if(target){const top=target.offsetTop-config.scrollOffset;window.scrollTo({top:top,behavior:'smooth'})}})})}function addStyles(){const style=document.createElement('style');style.textContent=`.wiki-toc-simple{background:0 0;border:none;border-radius:6px;padding:8px 12px;margin-bottom:16px;max-height:70vh;overflow-y:auto;position:sticky;top:16px;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.3) transparent}.wiki-toc-simple::-webkit-scrollbar{width:6px}.wiki-toc-simple::-webkit-scrollbar-track{background:0 0;border-radius:3px}.wiki-toc-simple::-webkit-scrollbar-thumb{background:rgba(255,255,255,.3);border-radius:3px;border:none}.wiki-toc-simple::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.5)}.wiki-toc-simple::-webkit-scrollbar-corner{background:0 0}.wiki-toc-title{font-size:16px;font-weight:700;margin-bottom:10px;color:#fff;border-bottom:1px solid #007bff;padding-bottom:6px}.wiki-toc-simple .wiki-toc-list{margin:0 0 0 -24px}.wiki-toc-list{list-style:none;padding:0;margin:0}.wiki-toc-item{margin:2px 0}.wiki-toc-link{display:block;padding:4px 8px;color:#fff;text-decoration:none;border-radius:3px;transition:all .2s;font-size:13px;line-height:1.3}.wiki-toc-link:hover{background-color:rgba(255,255,255,.1);color:#007bff}.wiki-toc-item[data-level="1"] .wiki-toc-link{font-weight:700;color:#fff;padding-left:4px}.wiki-toc-item[data-level="1"] .wiki-toc-link:hover{background-color:rgba(255,255,255,.15);padding-left:4px}.wiki-toc-item[data-level="2"] .wiki-toc-link{font-weight:600;color:#fff}@media (max-width:768px){.wiki-toc-simple{position:static;max-height:none}}`;document.head.appendChild(style)}function init(){addStyles();generateTOC()}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init)}else{init()}window.wikiTOCSimple={refresh:generateTOC,remove:removeExistingTOC,config:config}})();